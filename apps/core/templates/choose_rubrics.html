{% extends layout_path %}

{% load i18n %}
{% load static %}

{% block title %}Choose Rubrics{% endblock title %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <div class="mx-auto text-center">
            <h4>Choose Rubrics</h4>
        </div>
        <!-- Create Rubrics Button with Conditional Admin Check -->
        <a href="{% url 'create_rubric' %}"
           class="btn {% if user.is_staff or user.is_superuser %}btn-success{% else %}btn-secondary disabled{% endif %}"
           style="width: 120px;"
           {% if not user.is_staff and not user.is_superuser %}aria-disabled="true" tabindex="-1"{% endif %}>
            <i class="fas fa-plus"></i> Create Rubrics
        </a>
    </div>
</div>

<!-- Hidden input to track selected rubric type -->
<div id="rubricsForm">
    <input type="hidden" name="selected_rubric" id="selected_rubric" value="">

    {% for rubric in rubrics %}
    <!-- Dance Rubrics Card -->
    <div class="card mt-5 rubric-container">
        <div class="card-body text-center" onclick="selectRubric('Dance', this, {{rubric.id}})">
            <h5 class="card-title">{{rubric.name}} Rubrics</h5>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Rubric</th>
                        <th>Weight</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for criterion in rubric.criterion.all %}
                    <tr>
                        <td>{{ criterion.name }}</td>
                        <td>{{ criterion.percentage }}</td>
                        <td>{{ criterion.description }}</td> <!-- Assuming Criterion model has a 'description' field -->
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="button" class="btn btn-outline-primary select-btn mt-3">Select</button>
        </div>
    </div>

    {% endfor %}


    <!-- Submit Button -->
    <form class="container mt-5" method="GET" action="{% url 'new_contest' %}">
        <!-- Submit button initially disabled -->
        <input type="hidden" id="rubric_id" name="rubric_id" />
        <button type="submit" id="submitButton" class="btn btn-primary" disabled>Next</button>
    </form>
</div>

<script>
  // Function to select a rubric template
  function selectRubric(rubricType, card, rubric_id) {
      // Set the selected rubric type in the hidden input
      document.getElementById("selected_rubric").value = rubricType;

      // Reset all buttons to their original state
      const buttons = document.querySelectorAll('.select-btn');
      buttons.forEach(btn => {
          btn.innerText = 'Select';  // Reset button text
          btn.classList.remove('btn-success'); // Reset button styling
          btn.classList.add('btn-outline-primary'); // Ensure outline style is applied
      });

      // Change the clicked button's text and color
      const button = card.querySelector('.select-btn');
      button.innerText = 'Selected';  // Set the clicked button to "Selected"
      button.classList.remove('btn-outline-primary'); // Remove outline class
      button.classList.add('btn-success'); // Change button styling to indicate selection

      // Enable the submit button now that a rubric is selected
      document.getElementById("submitButton").disabled = false;
      document.getElementById("rubric_id").value = rubric_id;
  }
</script>

{% endblock content %}
