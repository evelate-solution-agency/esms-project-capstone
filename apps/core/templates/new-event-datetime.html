{% extends layout_path %}

{% block title %}
  Date Time
{% endblock %}

{% block content %}
  <div class="container">
    <form id="eventForm" method="POST" enctype="multipart/form-data">
      <!-- Specify your POST URL -->
      {% csrf_token %} <!-- Add CSRF token for security -->

      <div class="row justify-content-center card p-5 my-5">
        <div class="col-md-12 d-flex mb-4 justify-content-between">
          <h4 class="text-left fw-bold">Event Details</h4>
          <div class="button-wrapper">
            <label for="upload" class="btn btn-primary me-3 mb-4" tabindex="0">
              <span class="d-none d-sm-block">Upload image</span>
              <i class="ti ti-upload d-block d-sm-none"></i>
              <input type="file" id="upload" class="account-file-input" hidden accept="image/png, image/jpeg" name="event_image"/>
            </label>
          </div>
        </div>
        <div class="user-profile-header-banner mb-10">
          <img id="preview-image" src="{% static 'img/pages/profile-banner.png' %}" alt="Banner image" class="rounded-top img-fluid preview-image" style="width: 100%; height: auto; max-height: 500px; object-fit: cover;"/>
        </div>
        <!-- Title -->
        <div class="col-md-12 mb-4">
          <h5 class="form-label" style="">Event Title</h5>
          <input type="text" id="locationInput" name="event_title" class="form-control" placeholder="Enter event title" required />
        </div>

        <!-- Time Label and Inputs -->
        <div class="col-md-12">
          <div class="row">
            <div class="col-3">
              <label class="form-label" for="timeIn">Start Time:</label>
              <input type="time" id="timeIn" name="start_time" class="form-control" style="width: 100%;" required />
              <label class="form-label mt-1" id="displayTimeIn"></label> <!-- Display Selected Start Time -->
            </div>
            <div class="col-3">
              <label class="form-label" for="timeOut">End Time:</label>
              <input type="time" id="timeOut" name="end_time" class="form-control" style="width: 100%;" required />
              <label class="form-label mt-1" id="displayTimeOut"></label> <!-- Display Selected End Time -->
            </div>
            <div class="col-3">
              <label class="form-label" for="startDate">Start Date:</label>
              <input type="date" id="startDate" name="start_date" class="form-control" style="width: 100%;" required />
            </div>
            <div class="col-3">
              <label class="form-label" for="endDate">End Date:</label>
              <input type="date" id="endDate" name="end_date" class="form-control" style="width: 100%;" required />
            </div>
          </div>
        </div>

        <!-- Location Label and Input -->
        <div class="col-md-12 mb-4">
          <label class="form-label">Location:</label>
          <input type="text" id="locationInput" name="location" class="form-control" placeholder="Enter location keywords" required />
        </div>

        <!-- Capacity -->
        <div class="col-md-12 mb-4">
          <label class="form-label">Capacity:</label>
          <input type="number" id="capacity" name="capacity" class="form-control" placeholder="Enter capacity" required />
        </div>

        <!-- Notes Label and Input -->
        <div class="col-md-12 mb-4">
          <label class="form-label">Description:</label>
          <textarea id="notesInput" name="description" class="form-control" rows="4" placeholder="Type your description here..." style="width: 100%;"></textarea>
        </div>

        <!-- Hidden Inputs for Event Type, Sport, and Teams Data -->
        <input type="hidden" name="event_type" value="{{ event_type }}" />
        <input type="hidden" name="sport" value="{{ sport }}" />
        <input type="hidden" name="teams_data" value="{{ teams_data }}" />

        <!-- Send Button aligned to the right -->
        <div class="col-md-12 mb-4 d-flex justify-content-end">
          <button type="submit" class="btn btn-success" style="width: 80px;">Create</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    // Convert 24-hour time to 12-hour AM/PM format
    function formatTimeTo12Hour(time) {
      const [hours, minutes] = time.split(':');
      let period = 'AM';
      let hour = parseInt(hours, 10);
    
      if (hour >= 12) {
        period = 'PM';
        if (hour > 12) {
          hour -= 12;
        }
      } else if (hour === 0) {
        hour = 12;
      }
    
      return `${hour}:${minutes} ${period}`;
    }
    
    // Function to update the displayed Start Time
    document.getElementById('timeIn').addEventListener('change', function () {
      const timeInValue = document.getElementById('timeIn').value;
      const displayTimeIn = document.getElementById('displayTimeIn');
      if (timeInValue) {
        displayTimeIn.textContent = 'Start Time: ' + formatTimeTo12Hour(timeInValue);
      } else {
        displayTimeIn.textContent = '';
      }
    });
    
    // Function to update the displayed End Time
    document.getElementById('timeOut').addEventListener('change', function () {
      const timeOutValue = document.getElementById('timeOut').value;
      const displayTimeOut = document.getElementById('displayTimeOut');
      if (timeOutValue) {
        displayTimeOut.textContent = 'End Time: ' + formatTimeTo12Hour(timeOutValue);
      } else {
        displayTimeOut.textContent = '';
      }
    });
  </script>

  <script>
    document.getElementById('upload').addEventListener('change', function (event) {
      var input = event.target;
    
      if (input.files && input.files[0]) {
        var reader = new FileReader();
    
        reader.onload = function (e) {
          document.getElementById('preview-image').src = e.target.result;
        };
    
        reader.readAsDataURL(input.files[0]);
      }
    });
  </script>
{% endblock %}
